<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>Desafio do Luiz ü§ì</title>
<style>
  body {
    background: radial-gradient(circle at top, #142850, #000);
    color: #fff;
    font-family: "Poppins", sans-serif;
    text-align: center;
    height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    transition: background 0.5s ease;
  }

  h1 {
    font-size: 2rem;
    margin-bottom: 10px;
  }

  input, button {
    padding: 10px 15px;
    border-radius: 10px;
    border: none;
    margin: 5px;
    font-size: 1rem;
  }

  button {
    background: #00BFFF;
    color: #fff;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover { background: #0096c7; }

  .luiz-container {
    position: relative;
    margin-bottom: 20px;
    transition: transform 0.4s ease;
  }

  .balon {
    background: rgba(255,255,255,0.2);
    padding: 10px 18px;
    border-radius: 25px;
    max-width: 400px;
    margin-bottom: 12px;
    min-height: 40px;
    font-style: italic;
    animation: fadeIn 0.3s ease;
  }

  @keyframes fadeIn {
    from {opacity:0; transform:translateY(10px);}
    to {opacity:1; transform:translateY(0);}
  }

  .luiz {
    font-size: 4rem;
    transition: transform 0.3s, text-shadow 0.3s;
  }

  .feliz .luiz { text-shadow: 0 0 15px #00ff99; transform: scale(1.1); }
  .orgulhoso .luiz { text-shadow: 0 0 15px #00bfff; transform: scale(1.2); }
  .animado .luiz { text-shadow: 0 0 20px #00ffff; transform: scale(1.3); }
  .confuso .luiz { text-shadow: 0 0 15px #ffeb3b; transform: scale(1.05); }
  .zangado .luiz { text-shadow: 0 0 18px #ff4444; transform: scale(1.2); }
  .furioso .luiz { text-shadow: 0 0 25px #ff0000; transform: scale(1.3); }
  .explosao .luiz { animation: explode 0.8s forwards; }

  @keyframes explode {
    0% {transform: scale(1); opacity: 1;}
    100% {transform: scale(3); opacity: 0;}
  }

  .timer-bar {
    width: 80%;
    height: 18px;
    background-color: #ffffff33;
    border-radius: 10px;
    overflow: hidden;
    margin-top: 15px;
  }
  #barra-tempo {
    height: 100%;
    width: 100%;
    background-color: #00ff99;
    transition: width 0.9s linear;
  }

  #tempo-texto { margin-top: 5px; font-weight: bold; }

  #dificuldade {
    margin-top: 10px;
    font-size: 1.2rem;
    font-weight: bold;
    color: #00bfff;
  }

  #tela-gameover {
    display:none;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    position:absolute;
    top:0; left:0;
    width:100%; height:100%;
    background:rgba(0,0,0,0.9);
    text-align:center;
    animation: fadeIn 0.8s ease;
  }

  #tela-gameover h1 { color:#ff5555; font-size:2.5rem; text-shadow:0 0 20px #ff0000; }

  #ranking {
    margin-top: 15px;
    text-align: left;
    background: rgba(255,255,255,0.1);
    padding: 10px 20px;
    border-radius: 12px;
    max-width: 300px;
  }

  #ranking h2 { color: #00bfff; margin-bottom: 5px; }
</style>
</head>
<script src="{{ url_for('static', filename='perguntas.js') }}"></script>
<body>
  <div id="luiz" class="luiz-container feliz">
    <div class="balon" id="fala-luiz">Oi! Eu sou o Luiz ü§ì<br>Qual √© o seu nome?</div>
    <div class="luiz" id="emoji">ü§ì</div>
  </div>

  <div id="tela-nome">
    <input id="nome" placeholder="Digite seu nome...">
    <button onclick="iniciarJogo()">Come√ßar</button>
  </div>

  <div id="tela-jogo" style="display:none;flex-direction:column;align-items:center;">
    <h1 id="pergunta"></h1>
    <input id="entrada" placeholder="Digite sua resposta...">
    <button onclick="enviar()">Enviar</button>
    <div id="dificuldade"></div>
    <div class="timer-bar"><div id="barra-tempo"></div></div>
    <div id="tempo-texto">‚è≥ 30s</div>
  </div>

  <div id="tela-gameover">
    <h1 id="titulo-fim">üí• Voc√™ Perdeu!</h1>
    <p id="texto-fim"></p>
    <div id="ranking"></div>
    <button onclick="reiniciar()">Reiniciar</button>
  </div>

<script>
  const perguntas = window.bancoPerguntas;

  let nome="", pontuacao=0, tempo=30, intervalo, humor=0, acertos=0, modoPesadelo=false, usadas=[];
  const fala=document.getElementById("fala-luiz");
  const emoji=document.getElementById("emoji");
  const barra=document.getElementById("barra-tempo");
  const textoTempo=document.getElementById("tempo-texto");
  const dif=document.getElementById("dificuldade");

  function iniciarJogo(){
    nome=document.getElementById("nome").value||"Jogador";
    document.getElementById("tela-nome").style.display="none";
    document.getElementById("tela-jogo").style.display="flex";
    fala.innerHTML=`Vamos ver do que voc√™ √© capaz, ${nome}! üòé`;
    usadas=[];
    novaPergunta();
  }

  function definirDificuldade(){
    if(modoPesadelo) return "pesadelo";
    if(pontuacao<5) return "facil";
    if(pontuacao<10) return "medio";
    return "dificil";
  }

  function novaPergunta(){
    clearInterval(intervalo);
    const nivel=definirDificuldade();
    const lista=perguntas.filter(p=>p.dificuldade===nivel && !usadas.includes(p.texto));
    if(lista.length===0){usadas=[]; return novaPergunta();}
    const q=lista[Math.floor(Math.random()*lista.length)];
    usadas.push(q.texto);
    document.getElementById("pergunta").textContent=q.texto;
    const e=document.getElementById("entrada");
    e.value="";
    e.dataset.resposta=q.resposta;
    e.dataset.dica=q.dica;
    e.dataset.nivel=nivel;
    dif.textContent=`üéØ Dificuldade: ${modoPesadelo?"PESADELO üòà":nivel.toUpperCase()}`;
    iniciarTempo();
  }

  function iniciarTempo(){
    clearInterval(intervalo);
    const max=modoPesadelo?5:30;
    intervalo=setInterval(()=>{
      tempo--;
      barra.style.width=`${(tempo/max)*100}%`;
      textoTempo.textContent=`‚è≥ ${tempo}s`;
      if(tempo<=0) fim("raiva");
    },1000);
  }

  function enviar(){
    const e=document.getElementById("entrada");
    const r=e.value.toLowerCase().trim();
    const c=e.dataset.resposta;
    const dica=e.dataset.dica;
    const nivel=e.dataset.nivel;

    if(!r) return;

    if(r==="te amo"){
      fala.innerHTML="ü•∞ Eu tamb√©m te amo! Pode avan√ßar!";
      pontuacao++; humor=Math.max(0,humor-2); acertos++;
      tempo+=3;
      setTimeout(()=>avancar(nivel),800);
      return;
    }

    if(r===c){
      pontuacao++; acertos++; humor=Math.max(0,humor-1);
      const luiz=document.getElementById("luiz");
      luiz.className="luiz-container feliz";
      emoji.textContent="üòÅ";

      fala.innerHTML=["Boa! üëè","Mandou bem! üî•","Acertou, genial! üòé"][Math.floor(Math.random()*3)];

      let ganho=0;
      if(nivel==="facil") ganho=6;
      if(nivel==="medio") ganho=4;
      if(nivel==="dificil") ganho=2;
      if(modoPesadelo) ganho=1;
      tempo=Math.min(modoPesadelo?5:30,tempo+ganho);

      setTimeout(()=>avancar(nivel),800);
    }else{
      fala.innerHTML=`Errou üòÖ Dica: ${dica}`;
      acertos=0; humor++;
      tempo=modoPesadelo?0:Math.max(1,tempo-3);
      atualizarHumor();
    }
  }

  function avancar(nivel){
    if(nivel==="dificil" && pontuacao>=10 && !modoPesadelo){
      if(confirm("üòà Deseja entrar no MODO PESADELO (5s e sem errar)?")){
        modoPesadelo=true;
        fala.innerHTML="üî• Bem-vindo ao MODO PESADELO!";
        tempo=5;
      }else{
        fim("orgulho");
        return;
      }
    }
    novaPergunta();
  }

  function atualizarHumor(){
    const luiz=document.getElementById("luiz");
    luiz.className="luiz-container";
    if(humor<=2){luiz.classList.add("confuso");emoji.textContent="üòê";}
    else if(humor<=4){luiz.classList.add("zangado");emoji.textContent="üò†";}
    else if(humor<=6){luiz.classList.add("furioso");emoji.textContent="üò°";}
    else{fim("raiva");}
  }

  function fim(tipo){
    clearInterval(intervalo);
    document.getElementById("tela-jogo").style.display="none";
    document.getElementById("tela-gameover").style.display="flex";
    const t=document.getElementById("titulo-fim");
    const p=document.getElementById("texto-fim");
    if(tipo==="raiva"){t.textContent="üí• Voc√™ Perdeu!";p.textContent="O Luiz explodiu de raiva! üò°";}
    else if(tipo==="orgulho"){t.textContent="üèÜ Fim com Orgulho!";p.textContent="O Luiz est√° orgulhoso de voc√™! üòé";}
    else{t.textContent="üèÅ Fim de jogo!";p.textContent="Parab√©ns!";}

    salvarRanking();
  }

  function salvarRanking(){
    const id="#" + Math.random().toString(36).substring(2,8).toUpperCase();
    const registro={nome,pontuacao,id};
    let ranking=JSON.parse(localStorage.getItem("rankingLuiz")||"[]");
    ranking.push(registro);
    ranking.sort((a,b)=>b.pontuacao-a.pontuacao);
    ranking=ranking.slice(0,10);
    localStorage.setItem("rankingLuiz",JSON.stringify(ranking));
    exibirRanking(ranking);
  }

  function exibirRanking(r){
    const div=document.getElementById("ranking");
    div.innerHTML="<h2>üèÖ Top 10 Jogadores</h2>"+r.map((j,i)=>`<p>${i+1}. ${j.nome} (${j.pontuacao}) ${j.id}</p>`).join("");
  }

  function reiniciar(){window.location.reload();}

  document.getElementById("entrada").addEventListener("keypress",e=>{
    if(e.key==="Enter") enviar();
  });
  

</script>
</body>
</html>
