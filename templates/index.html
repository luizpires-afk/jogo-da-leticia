<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Desafio do Luiz ðŸ¤“</title>
  <style>
    body {
      background: linear-gradient(120deg, #0f2027, #203a43, #2c5364);
      color: white;
      font-family: "Poppins", sans-serif;
      text-align: center;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      transition: background 0.8s ease;
    }

    .container {
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .luiz-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin-bottom: 10px;
      position: relative;
    }

    /* BalÃ£o principal (fala do Luiz) */
    .balon {
      background: #ffffff22;
      padding: 10px 18px;
      border-radius: 25px;
      max-width: 360px;
      position: absolute;
      bottom: 130px;
      animation: aparecer 0.5s ease;
      font-style: italic;
      font-size: 0.95rem;
      text-align: center;
    }

    .balon::after {
      content: "";
      position: absolute;
      bottom: -12px;
      left: 45px;
      border-width: 12px;
      border-style: solid;
      border-color: #ffffff22 transparent transparent transparent;
    }

    /* Emoji do Luiz */
    .luiz {
      font-size: 4rem;
      animation: flutuar 3s ease-in-out infinite;
      transition: transform 0.3s ease, text-shadow 0.3s ease;
    }

    /* Pergunta */
    #pergunta {
      font-size: 1.3rem;
      margin-top: 40px;
      margin-bottom: 10px;
      font-weight: 600;
      text-shadow: 0 0 10px #ffffff55;
    }

    /* Campo e botÃ£o */
    input, button {
      padding: 10px;
      border-radius: 10px;
      border: none;
      font-size: 1rem;
      text-align: center;
      outline: none;
      transition: 0.3s;
    }

    input { width: 220px; }
    button {
      margin-top: 10px;
      background: #00BFFF;
      color: white;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover { background: #009ACD; }

    /* Dica e mensagens */
    #mensagem {
      margin-top: 20px;
      background: #ffffff22;
      padding: 10px 15px;
      border-radius: 10px;
      max-width: 350px;
      font-style: italic;
      animation: aparecer 0.6s ease;
    }

    /* Estados de humor */
    .feliz .luiz { text-shadow: 0 0 12px #00ff88; transform: rotate(4deg) scale(1.1); }
    .confuso .luiz { text-shadow: 0 0 12px #ffee55; transform: rotate(2deg) scale(1.05); }
    .zangado .luiz { text-shadow: 0 0 14px #ff3355; transform: rotate(-6deg) scale(1.2); }
    .furioso .luiz { text-shadow: 0 0 20px #ff0000; transform: scale(1.3) rotate(-10deg); }

    .feliz-bg { background: linear-gradient(120deg, #007a4d, #00aaff, #007a4d); }
    .confuso-bg { background: linear-gradient(120deg, #444444, #999933, #666600); }
    .zangado-bg { background: linear-gradient(120deg, #7a0000, #cc3333, #7a0000); }
    .furioso-bg { background: linear-gradient(120deg, #2c0000, #ff0000, #2c0000); }

    .nivel {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 0.9rem;
      opacity: 0.8;
    }

    @keyframes aparecer {
      0% { opacity: 0; transform: translateY(10px); }
      100% { opacity: 1; transform: translateY(0); }
    }

    @keyframes flutuar {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-8px); }
    }

    /* Efeitos de explosÃ£o */
    @keyframes shake {
      0%, 100% { transform: translate(0, 0); }
      20%, 60% { transform: translate(-10px, 10px); }
      40%, 80% { transform: translate(10px, -10px); }
    }
    .shake { animation: shake 0.8s ease-in-out; }
    .rage-flash { background-color: rgba(255, 0, 0, 0.4); transition: background-color 0.5s ease-out; }
  </style>
</head>
<body>
  <div class="nivel" id="nivel" style="display:none;">NÃ­vel: 1</div>

  <div id="luiz" class="luiz-container feliz">
    <div class="balon" id="fala-luiz">Oi! Eu sou o Luiz ðŸ¤“<br>Como vocÃª se chama?</div>
    <div class="luiz" id="emoji">ðŸ¤“</div>
  </div>

  <!-- Tela inicial -->
  <div id="tela-nome">
    <input id="nome" type="text" placeholder="Digite seu nome..." autocomplete="off">
    <button onclick="iniciarJogo()">ComeÃ§ar</button>
  </div>

  <!-- Tela do jogo -->
  <div id="tela-jogo" style="display:none; flex-direction: column; align-items: center;">
    <div id="pergunta">{{ pergunta }}</div>
    <input id="entrada" type="text" placeholder="Digite sua resposta..." autocomplete="off">
    <button onclick="enviar()">Enviar</button>
    <div id="mensagem" style="display:none;"></div>
  </div>

  <audio id="somAcerto" src="https://cdn.pixabay.com/download/audio/2021/08/09/audio_8d6c0b6a63.mp3?filename=correct-2-46134.mp3"></audio>
  <audio id="somErro" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_5e7b2a72ef.mp3?filename=error-126627.mp3"></audio>
  <audio id="somPensando" src="https://cdn.pixabay.com/download/audio/2021/08/04/audio_c48d16e06b.mp3?filename=thinking-6013.mp3"></audio>
  <audio id="explosionSound" src="static/sounds/explosion.mp3"></audio>

  <script>
    const luizDiv = document.getElementById("luiz");
    const emoji = document.getElementById("emoji");
    const msgDiv = document.getElementById("mensagem");
    const perguntaDiv = document.getElementById("pergunta");
    const nivelDiv = document.getElementById("nivel");
    const entrada = document.getElementById("entrada");
    const falaLuiz = document.getElementById("fala-luiz");

    const somAcerto = document.getElementById("somAcerto");
    const somErro = document.getElementById("somErro");
    const somPensando = document.getElementById("somPensando");
    const explosionSound = document.getElementById("explosionSound");

    let enviando = false;

    function explodirLuiz() {
      explosionSound.currentTime = 0;
      explosionSound.play();
      document.body.classList.add("shake", "rage-flash");
      setTimeout(() => document.body.classList.remove("shake", "rage-flash"), 1200);
    }

    async function iniciarJogo() {
      const nome = document.getElementById("nome").value.trim();
      if (!nome) return alert("Digite seu nome antes de comeÃ§ar!");

      await fetch("/definir_jogador", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ nome })
      });

      document.getElementById("tela-nome").style.display = "none";
      document.getElementById("tela-jogo").style.display = "flex";
      nivelDiv.style.display = "block";

      falaLuiz.innerHTML = `Bem-vindo, <b>${nome}</b>! ðŸ˜Ž<br>Vamos ver se vocÃª Ã© bom mesmo!`;
      setTimeout(() => falaLuiz.style.display = "none", 2500);
    }

    async function enviar() {
      if (enviando) return;
      const tentativa = entrada.value.trim();
      if (!tentativa) return;

      enviando = true;
      somPensando.play();

      const res = await fetch("/verificar", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ tentativa })
      });

      const data = await res.json();
      enviando = false;

      msgDiv.style.display = "block";
      msgDiv.innerHTML = data.mensagem;
      luizDiv.classList.remove("feliz", "confuso", "zangado", "furioso");
      document.body.classList.remove("feliz-bg", "confuso-bg", "zangado-bg", "furioso-bg");

      if (data.reiniciar) {
        if (data.humor === 4) explodirLuiz();
        luizDiv.classList.add("furioso");
        document.body.classList.add("furioso-bg");
        emoji.textContent = "ðŸ˜¤";
        somErro.play();
        setTimeout(() => {
          perguntaDiv.innerHTML = data.nova_pergunta;
          msgDiv.style.display = "none";
          emoji.textContent = "ðŸ¤“";
          luizDiv.classList.remove("furioso");
          document.body.classList.remove("furioso-bg");
          nivelDiv.textContent = "NÃ­vel: 1";
        }, 2500);
        return;
      }

      nivelDiv.textContent = "NÃ­vel: " + (data.nivel || 1);

      if (data.acertou) {
        luizDiv.classList.add("feliz");
        document.body.classList.add("feliz-bg");
        emoji.textContent = "ðŸ˜Ž";
        somAcerto.play();
        setTimeout(() => {
          perguntaDiv.innerHTML = data.nova_pergunta;
          msgDiv.style.display = "none";
          entrada.value = "";
          emoji.textContent = "ðŸ¤“";
          luizDiv.classList.remove("feliz");
          document.body.classList.remove("feliz-bg");
        }, 2000);
      } else {
        somErro.play();
        if (data.humor >= 3) {
          luizDiv.classList.add("furioso");
          document.body.classList.add("furioso-bg");
          emoji.textContent = "ðŸ˜¡";
        } else if (data.humor === 2) {
          luizDiv.classList.add("zangado");
          document.body.classList.add("zangado-bg");
          emoji.textContent = "ðŸ˜ ";
        } else if (data.humor === 1) {
          luizDiv.classList.add("confuso");
          document.body.classList.add("confuso-bg");
          emoji.textContent = "ðŸ˜…";
        }
      }
    }

    entrada.addEventListener("keypress", e => { if (e.key === "Enter") enviar(); });
  </script>
</body>
</html>
